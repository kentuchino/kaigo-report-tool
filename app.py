import streamlit as st
import google.generativeai as genai

# --- APIè¨­å®š ---
# ã‚³ãƒ¼ãƒ‰ã«ç›´æ¥æ›¸ã‹ãšã€Streamlitã®éš ã—è¨­å®šã‹ã‚‰èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã™
import os

# ã‚‚ã—è¨­å®šï¼ˆSecretsï¼‰ã«ã‚­ãƒ¼ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†ã€ãªã‘ã‚Œã°ç©ºã«ã™ã‚‹
api_key = st.secrets.get("GEMINI_API_KEY")

if api_key:
    genai.configure(api_key=api_key)
    model = genai.GenerativeModel('models/gemini-1.0-pro')
else:
    st.error("APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Manage appã®Secretsã§è¨­å®šã—ã¦ãã ã•ã„ã€‚")

# --- ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ---
st.set_page_config(layout="wide", page_title="ä»‹è­·å ±å‘Šæ›¸æ”¯æ´ãƒ„ãƒ¼ãƒ«")
st.title("ğŸ›¡ï¸ ä»‹è­·äº‹æ•…å ±å‘Šæ›¸ãƒ»ä½œæˆæ”¯æ´ï¼ˆPCå°‚ç”¨ç‰ˆï¼‰")
st.caption("â€»å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚ä½œæˆå¾Œã¯ä»‹è­·ã‚½ãƒ•ãƒˆã¸è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚")

col_left, col_right = st.columns([1, 1])

with col_left:
    st.subheader("1. çŠ¶æ³ã®é¸æŠãƒ»å…¥åŠ›")
    c1, c2 = st.columns(2)
    with c1:
        status = st.selectbox("èº«ä½“çŠ¶æ³", ["å…¨ä»‹åŠ©", "ä¸€éƒ¨ä»‹åŠ©", "è‡ªç«‹"])
        side = st.selectbox("éƒ¨ä½", ["å¥å´", "æ‚£å´", "è©²å½“ãªã—ãƒ»ä¸¡å´"])
    with c2:
        mobility = st.selectbox("ç§»å‹•æ‰‹æ®µ", ["è»Šæ¤…å­", "ç‹¬æ­©", "è‡¥åºŠ"])
        category = st.selectbox("äº‹æ•…ç¨®åˆ¥", ["å†…å‡ºè¡€", "èª¤è–¬", "è»¢å€’", "èª¤åš¥", "ãã®ä»–"])
    
    raw_text = st.text_area("çŠ¶æ³ãƒ¡ãƒ¢ï¼ˆç®‡æ¡æ›¸ãã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰", height=250)
    generate_btn = st.button("å ±å‘Šæ›¸ã‚’ç”Ÿæˆãƒ»ãƒã‚§ãƒƒã‚¯ã™ã‚‹", use_container_width=True)

with col_right:
    st.subheader("2. AIã®æ·»å‰Šãƒ»æ¸…æ›¸çµæœ")
    if generate_btn and raw_text:
        prompt = f"""
        ã‚ãªãŸã¯ä»‹è­·æ–½è¨­ã®ãƒªã‚¹ã‚¯ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ‹…å½“è€…ã§ã™ã€‚
        ä»¥ä¸‹ã®ã€å…¥åŠ›æƒ…å ±ã€‘ã‚’å…ƒã«ã€äº‹æ•…å ±å‘Šæ›¸ã‚’æ¸…æ›¸ã—ã¦ãã ã•ã„ã€‚
        
        ã€å³å®ˆãƒ«ãƒ¼ãƒ«ã€‘
        1. åŒ»å­¦çš„æ–­å®šã¯çµ¶å¯¾ã«é¿ã‘ã‚‹ã€‚ã€Œï½ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã€ã€Œï½ã¨æ¨è«–ã•ã‚Œã‚‹ã€ç­‰ã®è¡¨ç¾ã«å¾¹ã™ã‚‹ã“ã¨ã€‚
        2. ã€Œå†…å‡ºè¡€ã€ç­‰ã®ç”¨èªã¯ãã®ã¾ã¾ä½¿ç”¨ã—ã¦è‰¯ã„ã€‚
        3. èº«ä½“çŠ¶æ³ï¼ˆ{status}ï¼‰ã€éƒ¨ä½ï¼ˆ{side}ï¼‰ã€ç§»å‹•æ‰‹æ®µï¼ˆ{mobility}ï¼‰ã®æƒ…å ±ã‚’æ–‡ä¸­ã«å«ã‚ã‚‹ã“ã¨ã€‚
        
        ã€å…¥åŠ›æƒ…å ±ã€‘
        ç¨®åˆ¥ï¼š{category} / çŠ¶æ³ï¼š{raw_text}
        
        ã€å‡ºåŠ›æ§‹æˆã€‘
        â‘  ç™ºç”ŸçŠ¶æ³ï¼ˆå®¢è¦³çš„äº‹å®Ÿï¼‰
        â‘¡ è¦å› ã®æ¨å¯Ÿï¼ˆæ–­å®šã›ãšã€å¤šè§’çš„ã«ï¼‰
        â‘¢ ã€é‡è¦ã€‘ä¸è¶³ã—ã¦ã„ã‚‹ç¢ºèªäº‹é …ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ã¸ã®é€†è³ªå•ï¼‰
        """
        response = model.generate_content(prompt)
        st.markdown(response.text)
        st.button("ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã‚’åˆ©ç”¨ï¼‰")
